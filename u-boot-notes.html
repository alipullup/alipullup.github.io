<!DOCTYPE html>
<html lang="en">
<head>
        <title>U-Boot Notes</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="./theme/css/main.css" />
	<link rel="stylesheet" href="./css/autumn.css" />
        <link href="https://alipullup.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Ali's Posts Full Atom Feed" />
        <link href="https://alipullup.github.io/feeds/misc.atom.xml" type="application/atom+xml" rel="alternate" title="Ali's Posts Categories Atom Feed" />
</head>
<body>

    <div class="navigation pure-menu pure-menu-horizontal">
        <a href="./" class="pure-menu-heading  pure-menu-link">Ali's Posts</a>
        <ul class="pure-menu-list">
            <li class="pure-menu-item"></li>
            <li class="pure-menu-item"><a href="/archives.html" class="pure-menu-link">Archives</a></li>
            <li class="pure-menu-item"><a href="/categories.html" class="pure-menu-link">Categories</a></li>
            <li class="pure-menu-item"><a href="/tags.html" class="pure-menu-link">Tags</a></li>

            <li class="pure-menu-item"><a href="./pages/about-me.html" class="pure-menu-link">About me</a></li>
        </ul>
    </div>


<div class="page-container">
    <div class="entry-content">
        <div class="post-meta pure-g">
<div class="pure-u-3-4 meta-data">
    <a href="./category/misc.html" class="category">misc</a><br />

    <a class="author" href="./author/ali-imran.html">Ali Imran</a>
    &mdash; <abbr title="2013-06-13T00:00:00-04:00">Thu 13 June 2013</abbr>
</div>        </div>
    </div>

    <div class="article-header-container">
        <div class="background-image-container">

            <div class="background-image-small">
                <div class="title-container">
                    <h1>U-Boot Notes</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="entry-content">
        <h1>Introduction</h1>
<p>The following document contains some notes I took while debugging U-Boot board initialization for the MIPS and ARM platforms.</p>
<p>On one platform we had issues with the QSPI flash.  On another platform we had memory issues.  Yet another platform had issues with calling certain functions before some hardware was initialized.</p>
<hr />
<h1>Startup</h1>
<p>The system jumps to the <code>_start</code> routine. This is mapped to a known address in Flash.</p>
<p><img alt="U-Boot Startup" src="images/uboot-startup-startS.png" /></p>
<p>The <code>board_init_f</code> function calls various other functions:</p>
<p><img alt="Function board_init_f" src="images/uboot-board_init_f.png" /></p>
<h1>DTS File overview</h1>
<p>A Device Tree Source (dts) file is compiled by the Device
  Tree Compiler (dtc) into a Device Tree Blob (dtb).</p>
<p>The dts file describes resources found on the chip, including:</p>
<ul>
<li>Chip selects, and timings</li>
<li>I2C devices</li>
<li>etc.</li>
</ul>
<p><img alt="U-Boot DTS Overview" src="images/u-boot-dts--overview.png" /></p>
<h2>Location</h2>
<p>The =.dts= file is found in </p>
<p>(REMOVED)</p>
<h2>Format</h2>
<p>The dts file consists of nodes, with properties and children.</p>
<ul>
<li>Text strings (null terminated) are represented with double quotes:<ul>
<li><code>string-property = "a string"</code></li>
</ul>
</li>
<li>&lsquo;Cells&rsquo; are 32 bit unsigned integers delimited by angle brackets:<ul>
<li><code>cell-property = &lt;0xbeef 123 0xabcd1234&gt;</code></li>
</ul>
</li>
<li>Binary data is delimited with square brackets:<ul>
<li><code>binary-property = [0x01 0x23 0x45 0x67]</code></li>
</ul>
</li>
<li>Data of differing representations can be concatenated together using a comma:<ul>
<li><code>mixed-property = "a string", [0x01 0x23 0x45 0x67], &lt;0x12345678&gt;</code></li>
</ul>
</li>
<li>Commas are also used to create lists of strings:<ul>
<li><code>string-list = "red fish", "blue fish"</code></li>
</ul>
</li>
</ul>
<h2>Conventions</h2>
<ul>
<li>Node may have an <em>address</em>: <code>name@0 { ... }</code></li>
<li>Names can be up to 31 characters in length</li>
<li>Siblings must use different names, or different addresses:<ul>
<li><code>flash0{} flash1{}</code></li>
<li><code>flash@0{} flash@1{}</code></li>
</ul>
</li>
</ul>
<h2>The <code>compatible</code> property</h2>
<p>The <code>compatible</code> property is a list of strings:</p>
<ol>
<li>The first string specifies the exact device</li>
<li>The following strings represent other devices that the device
      is <em>compatible</em> with</li>
</ol>
<h2>Addressing (=reg=, =#address-cells=, =#size-cells=)</h2>
<p>Each addressable device gets a =reg= which is a list in the 
   form</p>
<p><code>reg = &lt;addr1 len1 [addr2 len2] ...&gt;</code></p>
<p>The special variables <code>#address-cells</code> and <code>#size-cells</code> in the
   parent node are used to state how many cells are in each field.</p>
<h2>Resources</h2>
<ul>
<li><a href="http://www.devicetree.org/Device_Tree_Usage">Device Tree Usage</a></li>
</ul>
    </div>

    <footer>
        <div class="tags">
            <a href="./tag/programming.html">programming</a>
        </div>
        <div class="pure-g post-footer">
            <div class="pure-u-1 pure-u-md-1-2">
                <div class="pure-g poster-info">
                    <div class="pure-u">
                        <a href="./author/ali-imran.html"><img src="//github.com/alipullup.png?size=120" alt=""></a>
                    </div>
                    <div class="pure-u-3-4">
                        <h3 class="author-name"><a href="./author/ali-imran.html">Ali Imran</a></h3>
                        <p class="author-description">
                          Software Engineer
                        </p>
                    </div>
                </div>
            </div>



        </div>


    </footer>


</div>



    <footer class="index-footer">

        <a href="./" title="Ali's Posts">Ali's Posts</a>
        <a href="/archives.html">Archives</a></li>
        <a href="/categories.html">Categories</a></li>
        <a href="/tags.html">Tags</a></li>
        <a href="./pages/about-me.html">About me</a>

    </footer>

</body>
</html>